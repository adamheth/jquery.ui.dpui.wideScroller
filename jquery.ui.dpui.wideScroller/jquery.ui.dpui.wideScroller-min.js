(function($){$.widget("ui.wideScroller",{options:{offsetLocatorID:'#locator',itemsClass:'.scrollable-item',activeItemClass:'active',container:'#scroller-container',nextButton:'.next',prevButton:'.prev',showItemNumbers:true,currentItemDisplayClass:'.ws-currentItem',totalItemDisplayClass:'.ws-totalItems',loaderID:'#scroller-spinner',goToItem:null,easing:'linear',speed:600},_create:function(){var self=this,o=this.options,e=this.element;e.addClass("dpui-widget");$(window).resize($.throttle(500,function(){self.resize();}));self._bindControls();self.itemsLength=$(o.itemsClass).length;if(self.itemsLength<=1){$(o.prevButton+", "+o.nextButton).hide();}
if(o.goToItem!==null){self._reOrderItems();}
self._initialState=e.html();self.setItemPosition();},_bindControls:function(){var self=this,o=this.options;$(o.nextButton).bind('click',function(event){self.moveNext();self._unbindControls();self._trigger('next',event);return false;});$(o.prevButton).bind('click',function(event){self.movePrev();self._unbindControls();self._trigger('previous',event);return false;});},_unbindControls:function(){var o=this.options;$(o.prevButton+","+o.nextButton).unbind();},_reOrderItems:function(){var o=this.options,items=$(o.itemsClass);items.removeClass(o.activeItemClass);$(items[o.goToItem-1]).addClass(o.activeItemClass);for(var i=0;i<(o.goToItem-1);i++){$(items[i]).detach().appendTo(o.container);}
items=null;},setItemPosition:function(){var self=this,o=this.options,windowOffset=$(o.offsetLocatorID).offset(),windowWidth=$(window).width(),items=$(o.itemsClass),offsetWidth=0,leftWidth=0,overflowElements=[],count=0;$.each(items,function(){if(offsetWidth===0){$(this).css('left',windowOffset.left);offsetWidth=$(this).outerWidth();}else{if((offsetWidth+windowOffset.left)>=windowWidth){overflowElements[count]=this;count++;}else{$(this).css('left',(offsetWidth+windowOffset.left));offsetWidth+=$(this).outerWidth();}}});overflowElements.reverse();$.each(overflowElements,function(){leftWidth+=$(this).outerWidth();$(this).css('left',(windowOffset.left-leftWidth)).prependTo(o.container);});self._updateItemNumber();self.hideLoader();},moveNext:function(){var self=this,o=this.options,e=this.element,windowWidth=$(window).width(),items=$(o.itemsClass),itemsLength=$(o.itemsClass).length,activeItem=e.find("."+o.activeItemClass),totalWidth=0;self._highlightItem('next');var lastItem=$(items).last();var offset=lastItem.offset();self.swappedElement=$(items).first();$('<div></div>').html(self.swappedElement.html()).addClass('scrollable-item').css('left',(lastItem.outerWidth()+offset.left)).appendTo(o.container);lastItem=$(o.itemsClass).last();totalWidth=(parseInt(lastItem.css("left"),10)+lastItem.outerWidth())-activeItem.outerWidth();if(totalWidth<windowWidth){var i=0;while(totalWidth<=windowWidth){i++;$(items[i]).css('left',(lastItem.outerWidth()+lastItem.offset().left)).detach().appendTo(o.container);totalWidth+=$(items[i]).outerWidth();lastItem=$(items[i]);}}
var moveDistance=activeItem.outerWidth()+"px";self._scroll('next',moveDistance,function(){self._scrollOnComplete('next');});},movePrev:function(){var self=this,o=this.options,e=this.element,windowWidth=$(window).width(),items=$(o.itemsClass),activeItem=e.find("."+o.activeItemClass);self.shortClass="";self.nextItem="";self._highlightItem('prev');var lastItem=$(o.itemsClass).last();var totalWidth=(parseInt(lastItem.css("left"),10)+lastItem.outerWidth())-activeItem.outerWidth();if(lastItem.offset().left+self.nextItem.outerWidth()>windowWidth){var firstItem=$(items).first();var offset=firstItem.offset();self.swappedElement=$(items).last();$('<div></div>').html(self.swappedElement.html()).addClass('scrollable-item '+self.shortClass).css('left',(offset.left-self.swappedElement.outerWidth())).prependTo(o.container);}
var moveDistance=self.nextItem.outerWidth()+"px";self._scroll('prev',moveDistance,function(){self._scrollOnComplete('prev');});},_scroll:function(direction,distance,callback){var self=this,o=this.options,e=this.element,count=0;self._trigger('startScroll');switch(direction){case"next":$(o.itemsClass).animate({'left':"-="+distance},o.speed,o.easing,function(){count++;if(count>=$(o.itemsClass).length){callback();}});break;case"prev":$(o.itemsClass).animate({'left':"+="+distance},o.speed,o.easing,function(){count++;if(count>=$(o.itemsClass).length){callback();}});break;default:break;}},_scrollOnComplete:function(direction){var self=this,o=this.options;if(self.swappedElement){self.swappedElement.remove();self.swappedElement=null;}
self._bindControls();self._updateItemNumber(direction);self._trigger('stopScroll');},_highlightItem:function(direction){var self=this,o=this.options,e=this.element,activeItem=e.find("."+o.activeItemClass);if(direction==="next"){self.nextItem=activeItem.next();}else{if(activeItem.prev().length!==0){self.nextItem=activeItem.prev();}else{self.nextItem=$(o.itemsClass).last();self.shortClass=o.activeItemClass;}}
activeItem.removeClass(o.activeItemClass);self.nextItem.addClass(o.activeItemClass);},_updateItemNumber:function(direction){var self=this,o=this.options,e=this.element;if(o.showItemNumbers){var currentPage=parseInt($(o.currentItemDisplayClass).html(),10);$(o.totalItemDisplayClass).html(self.itemsLength);switch(direction){case"next":if(currentPage<self.itemsLength){currentPage++;}else{currentPage=1;}
$(o.currentItemDisplayClass).html(currentPage);break;case"prev":if(currentPage>1){currentPage--;}else{currentPage=self.itemsLength;}
$(o.currentItemDisplayClass).html(currentPage);break;default:$(o.currentItemDisplayClass).html("1");break;}}},resize:function(){var self=this,o=this.options,e=this.element;e.html(self._initialState);self.setItemPosition();self._trigger('resize');},hideLoader:function(){var self=this,o=this.options;if(o.loaderID!==null){setTimeout(function(){$(o.loaderID).fadeOut();},800);}},showLoader:function(){var self=this,o=this.options;if(o.loaderID!==null){setTimeout(function(){$(o.loaderID).fadeIn();},800);}},destroy:function(){var self=this,o=this.options,e=this.element;e.removeClass('rid-widget');$(o.nextButton).unbind('click');$(o.prevButton).unbind('click');self.hideLoader();e.html(self._initialState);$(o.itemsClass).css('left','0');$.Widget.prototype.destroy.apply(this,arguments);return this;}});})(jQuery);